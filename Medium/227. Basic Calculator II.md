# 227. Basic Calculator II

---

## Problem Restatement
We are given a string `s` representing a valid mathematical expression with:
- Non-negative integers
- Operators: `+`, `-`, `*`, `/`
- Spaces may appear anywhere

We must evaluate the expression and return the result.  
Division must truncate toward zero.  
We cannot use built-in evaluation functions like `eval()`.

---

## Key Idea
- Traverse the string character by character.  
- Maintain:
  - `currentNumber` → the number being built from digits.  
  - `lastNumber` → the last evaluated number (important for handling `*` and `/`).  
  - `result` → accumulated sum.  
  - `operation` → the last operator seen.  
- When encountering an operator or reaching the end:
  - Apply the previous operator to `currentNumber`.  
  - For `+` and `-`: add `lastNumber` to `result`, set `lastNumber = ±currentNumber`.  
  - For `*` and `/`: update `lastNumber = lastNumber * currentNumber` or truncated division.  
- At the end, add `lastNumber` to `result`.

This avoids building full stacks and ensures O(n) time.

---

## Code (C#)
```csharp
public class Solution {
    public int Calculate(string s) {
        if (string.IsNullOrEmpty(s)) return 0;

        int result = 0;
        int lastNumber = 0;
        int currentNumber = 0;
        char operation = '+';

        for (int i = 0; i < s.Length; i++) {
            char c = s[i];

            if (char.IsDigit(c)) {
                currentNumber = currentNumber * 10 + (c - '0');
            }

            if ((!char.IsDigit(c) && c != ' ') || i == s.Length - 1) {
                if (operation == '+') {
                    result += lastNumber;
                    lastNumber = currentNumber;
                } else if (operation == '-') {
                    result += lastNumber;
                    lastNumber = -currentNumber;
                } else if (operation == '*') {
                    lastNumber = lastNumber * currentNumber;
                } else if (operation == '/') {
                    lastNumber = lastNumber / currentNumber;
                }

                operation = c;
                currentNumber = 0;
            }
        }

        result += lastNumber;
        return result;
    }
}
```


## Time Complexity
- **Traversal:** Each character in the string is processed exactly once.  
- **Operations:** Parsing digits, updating variables, and applying operators are constant-time.  
- **Overall:** **O(n)**, where n = length of the string.  

---

## Space Complexity
- **Variables:** `result`, `lastNumber`, `currentNumber`, and `operation`.  
- **No extra data structures** like stacks or arrays are required.  
- **Overall:** **O(1)**.  

---

## Example Walkthrough

### Example 1
**Input:** `"3+2*2"`  
- Process `3` → lastNumber = 3  
- `+` → result = 0, lastNumber = 3  
- Process `2` → lastNumber = 2  
- `*` → lastNumber = 2 * 2 = 4  
- Final result = 3 + 4 = 7 ✅  

---

### Example 2
**Input:** `" 3/2 "`  
- Process `3` → lastNumber = 3  
- `/` → lastNumber = 3 / 2 = 1 (truncated toward zero)  
- Final result = 1 ✅  

---

### Example 3
**Input:** `" 3+5 / 2 "`  
- Process `3` → lastNumber = 3  
- `+` → result = 0 + 3, lastNumber = 5  
- `/` → lastNumber = 5 / 2 = 2  
- Final result = 3 + 2 = 5 ✅  

---

## Why This Works
- **Operator precedence:** `lastNumber` ensures multiplication/division are applied before addition/subtraction.  
- **Accumulation:** `result` stores completed terms, while `lastNumber` holds the current term being processed.  
- **Division:** C# integer division naturally truncates toward zero, matching the problem requirement.  

---

## Edge Cases
- **Single number:** `"42"` → result = 42.  
- **Spaces:** `"  7 + 3 "` → handled correctly by skipping spaces.  
- **Large numbers:** Works within 32-bit integer range.  
- **Mixed operators:** `"14-3/2"` → correctly evaluates to 13.  

---

✅ **Conclusion**  
This is the **Single-Pass Operator Tracking Algorithm**.  
By maintaining `lastNumber`, `currentNumber`, and `result`, we evaluate expressions in **O(n)** time and **O(1)** space, without stacks or `eval`, while respecting operator precedence and truncating division.


---
