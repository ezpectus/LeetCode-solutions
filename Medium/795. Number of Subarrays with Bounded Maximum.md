# 795. Number of Subarrays with Bounded Maximum

---

## Problem Summary
We are given:
- An integer array `nums`.
- Two integers `left` and `right`.

We need to count the number of contiguous non-empty subarrays such that the **maximum element** of the subarray lies within the range `[left, right]`.

---

## Code Idea
This problem can be solved using a **sliding window / counting technique**:

1. **Key Observation**  
   - Count subarrays where the maximum ≤ `right`.  
   - Subtract subarrays where the maximum < `left`.  
   - The difference gives subarrays where maximum ∈ `[left, right]`.

2. **Helper Function `Count(nums, bound)`**  
   - Counts subarrays where the maximum ≤ `bound`.  
   - Traverse `nums` with a running counter `cur`:  
     - If `nums[i] ≤ bound`, increment `cur`.  
     - Else reset `cur = 0`.  
     - Add `cur` to result.  
   - This works because each valid element extends all previous valid subarrays.

3. **Final Result**  
   - `Count(nums, right) - Count(nums, left - 1)`.

---

## Code (C#)
```csharp
public class Solution {
    public int NumSubarrayBoundedMax(int[] nums, int left, int right) {
        return Count(nums, right) - Count(nums, left - 1);
    }

    private int Count(int[] nums, int bound) {
        int res = 0, cur = 0;
        foreach (int num in nums) {
            if (num <= bound) {
                cur++;
            } else {
                cur = 0;
            }
            res += cur;
        }
        return res;
    }
}
```



## Complexity
- **Time:** O(n), single pass through array for each bound.  
- **Space:** O(1), only counters used.  

---

## Pitfalls
- Must handle case when `left = 0` (then `left - 1 = -1`, all elements > -1 are valid).  
- Ensure subtraction logic is correct: `Count(right) - Count(left - 1)`.  
- Large values of `nums[i]` up to 1e9 → but only comparisons, no overflow risk.  
- Edge case: array length = 1.  

---

## Example Walkthrough
**Input:** `nums = [2,1,4,3], left = 2, right = 3`  
- `Count(nums, 3) = 5` (subarrays with max ≤ 3).  
- `Count(nums, 1) = 2` (subarrays with max ≤ 1).  
- Result = 5 - 2 = 3.  
**Output:** `3`.  

**Input:** `nums = [2,9,2,5,6], left = 2, right = 8`  
- `Count(nums, 8) = 12`.  
- `Count(nums, 1) = 5`.  
- Result = 12 - 5 = 7.  
**Output:** `7`.  

---

## Conclusion
This problem reduces to **counting subarrays with bounded maximum** using a helper function.  
- Efficient O(n) solution.  
- Works by subtracting counts for different bounds.  
- Handles edge cases cleanly with simple logic.  



---
