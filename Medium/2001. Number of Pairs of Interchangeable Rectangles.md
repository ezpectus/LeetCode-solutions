## üß© 2001. Number of Pairs of Interchangeable Rectangles  
**Ratio Normalization via GCD ‚Äî Hashing + Combinatorics**

---

### üß† Problem  
You are given a list of rectangles `rectangles[i] = [width, height]`.  
Two rectangles are interchangeable if they have the same aspect ratio:  
`width_i / height_i == width_j / height_j`  

Return the total number of interchangeable pairs.

---

### üéØ Goal  
- Normalize each rectangle's aspect ratio  
- Group rectangles by ratio  
- Count the number of unique pairs within each group  
- Return the total count

---

### ‚öôÔ∏è Architectural Triggers

| Trigger | Implication |
|--------|-------------|
| Same width-to-height ratio | Normalize as reduced fraction `(w/gcd, h/gcd)` |
| Count pairs | Use combination formula `k * (k - 1) / 2` |
| Up to 100,000 rectangles | Requires linear-time hashing |
| Avoid floating-point errors | Use integer pairs instead of `double` |

---

### üß© Algorithm Breakdown  
1. For each rectangle `[w, h]`, compute `gcd(w, h)`  
2. Normalize the ratio as `(w/g, h/g)`  
3. Use a hash map to count how many rectangles share each ratio  
4. For each group of `k` rectangles, contribute `k * (k - 1) / 2` pairs  
5. Accumulate the total

---

### üíª Optimized Code (C++)

```cpp
class Solution {
public:
    struct RatioHash {
        size_t operator()(const pair<int, int>& p) const {
            return hash<long long>()(((long long)p.first << 32) | p.second);
        }
    };

    long long interchangeableRectangles(vector<vector<int>>& rectangles) {
        unordered_map<pair<int, int>, int, RatioHash> count;
        long long result = 0;

        for (const auto& rect : rectangles) {
            int w = rect[0], h = rect[1];
            int g = gcd(w, h);
            pair<int, int> ratio = {w / g, h / g};
            result += count[ratio]++;
        }

        return result;
    }

private:
    int gcd(int a, int b) {
        while (b) {
            int t = b;
            b = a % b;
            a = t;
        }
        return a;
    }
};
```

### ‚è± Complexity

| Metric | Value |
|--------|-------|
| Time   | O(n) ‚Äî single pass + GCD |
| Space  | O(n) ‚Äî hash map of ratios |

---

### ‚ö†Ô∏è Pitfalls & Fixes

| Issue                      | Fix                                               |
|---------------------------|----------------------------------------------------|
| Floating-point precision loss | Use reduced integer pairs `(w/g, h/g)`             |
| Incorrect pair counting    | Use `result += count[ratio]++` to count before increment |
| Hashing integer pairs      | Use custom hash function for `pair<int,int>`       |

---

### üß† Insight

This is a classic group-by-key problem with combinatorial aggregation. It combines:

- Ratio normalization via GCD  
- Hash-based grouping  
- Pair counting via `k * (k - 1) / 2`

---

### üìö Fichka Library Entry

**Geometry / Hashing**  
> Count interchangeable rectangle pairs by normalized aspect ratio ‚Äî GCD + hash + combinatorics

---

