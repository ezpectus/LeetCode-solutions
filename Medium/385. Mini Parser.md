# 385. Mini Parser

---

##  Problem Restatement
You are given a string `s` representing the serialization of a nested list.  
Implement a parser to deserialize it and return the deserialized `NestedInteger`.

Each element is either:
- an integer, or
- a list whose elements may also be integers or other lists.

Constraints:  
- 1 ≤ s.length ≤ 5 * 10^4  
- Values are in range [-10^6, 10^6]  
- Input is guaranteed to be valid.

---

##  Core Idea
- If the string starts with a digit or `-`, it is just a single integer.  
- Otherwise, parse it as a nested list using a **stack**.  
- Each `[` starts a new list.  
- Each `]` closes the current list.  
- Numbers are built character by character and added when encountering `,` or `]`.  
- Stack ensures proper handling of nested structures.

---

##  Code (C#)
```csharp
public class Solution {
    public NestedInteger Deserialize(string s) {
        if (string.IsNullOrEmpty(s)) return null;

        // Case: single integer
        if (s[0] != '[') {
            return new NestedInteger(int.Parse(s));
        }

        Stack<NestedInteger> stack = new Stack<NestedInteger>();
        NestedInteger curr = null;
        int num = 0;
        bool negative = false;
        bool buildingNumber = false;

        for (int i = 0; i < s.Length; i++) {
            char c = s[i];

            if (c == '[') {
                NestedInteger ni = new NestedInteger();
                if (stack.Count > 0) {
                    stack.Peek().Add(ni);
                }
                stack.Push(ni);
            } else if (c == ']') {
                if (buildingNumber) {
                    stack.Peek().Add(new NestedInteger(negative ? -num : num));
                    buildingNumber = false;
                    num = 0;
                    negative = false;
                }
                curr = stack.Pop();
            } else if (c == ',') {
                if (buildingNumber) {
                    stack.Peek().Add(new NestedInteger(negative ? -num : num));
                    buildingNumber = false;
                    num = 0;
                    negative = false;
                }
            } else if (c == '-') {
                negative = true;
            } else if (char.IsDigit(c)) {
                buildingNumber = true;
                num = num * 10 + (c - '0');
            }
        }

        return curr;
    }
}
```


##  Complexity
- **Time:** O(N) — one pass through the string, where N = input length.  
- **Space:** O(N) — the stack stores currently open lists, depth proportional to nesting level.  

---

##  Pitfalls
- **Negative numbers:** must correctly handle the `-` sign before digits.  
- **Flag reset:** after adding a number to the list, reset `num`, `negative`, and `buildingNumber`.  
- **Empty list:** `[]` should return a valid empty `NestedInteger`.  
- **Deep nesting:** recursion may overflow, so a stack is the safe approach.  
- **Delimiters:** when encountering `,` or `]`, add the built number if one was being constructed.  

---

##  Conclusion
The problem reduces to **stack‑based parsing of nested structures**.  
- Each `[` opens a new list.  
- Each `]` closes the current list.  
- Numbers are built character by character and added at delimiters.  
Result: clean O(N) solution, robust for deep nesting and negative values.  

---

##  Generalization
- This pattern applies to **JSON/XML parsing**, **expression evaluation**, and **nested data deserialization**.  
- Key technique: **stack manages nested scopes**, while elements are added incrementally.  
- Can be extended to support more complex formats (e.g., key‑value pairs, arrays of objects).  

---

##  Example Walkthrough
For the string:  
`s = "[123,[456,[789]]]"`

1. Encounter `[` → create a new list, push onto the stack.  
2. Read `123` → add the number to the current list.  
3. Encounter `[` → new nested list, push onto the stack.  
4. Read `456` → add to the current list.  
5. Encounter `[` → another nested list.  
6. Read `789` → add to the innermost list.  
7. Close bracket `]` → return to the previous level.  
8. Repeat until the stack is empty.  

Result:  
`[123,[456,[789]]]` as a correct `NestedInteger` structure.  



---
