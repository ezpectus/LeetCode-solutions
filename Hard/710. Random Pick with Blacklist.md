# 710. Random Pick with Blacklist

---

## Problem Restatement
We need to design a data structure that:
- Initializes with `n` and a blacklist of numbers.
- Returns a random integer in `[0, n-1]` that is **not** in the blacklist.
- All valid numbers must be equally likely.

Constraints:
- `n` can be as large as 10^9.
- Blacklist length up to 10^5.
- Up to 20,000 calls to `pick`.

---

## Key Idea
We cannot store all valid numbers (too large).  
Instead, we use **mapping + random range reduction**:

1. Let `M = n - blacklist.length` = number of valid picks.  
2. We only pick random numbers in `[0, M-1]`.  
3. If a number in `[0, M-1]` is blacklisted, we map it to a valid number in `[M, n-1]`.  
   - This ensures uniform distribution.  
4. Store mappings in a dictionary for O(1) lookup.

---

## Code (C#)
```csharp
public class Solution {
    private Dictionary<int, int> map;
    private int M;
    private Random rand;

    public Solution(int n, int[] blacklist) {
        map = new Dictionary<int, int>();
        rand = new Random();
        M = n - blacklist.Length;

        HashSet<int> blackSet = new HashSet<int>(blacklist);

        // Collect valid numbers in [M, n-1]
        Queue<int> spare = new Queue<int>();
        for (int x = M; x < n; x++) {
            if (!blackSet.Contains(x)) {
                spare.Enqueue(x);
            }
        }

        // Map blacklisted numbers in [0, M-1] to spare numbers
        foreach (int b in blacklist) {
            if (b < M) {
                map[b] = spare.Dequeue();
            }
        }
    }
    
    public int Pick() {
        int x = rand.Next(M); // random in [0, M-1]
        if (map.ContainsKey(x)) return map[x];
        return x;
    }
}
```


## Complexity
- **Initialization:** O(blacklist.length), since we only process blacklisted values and build mappings.  
- **Pick:** O(1), constant-time random generation and dictionary lookup.  
- **Space:** O(blacklist.length), storing mappings for blacklisted values in the reduced range.  

---

## Example Walkthrough
**Input:** `n = 7, blacklist = [2,3,5]`

- M = 7 - 3 = 4 → random range `[0,3]`.  
- Blacklist in `[0,3]` = {2,3}.  
- Spare numbers in `[4,6]` = {4,6}.  
- Map: 2 → 4, 3 → 6.  

**Valid picks:** {0,1,4,6}, each equally likely ✅  

---

## Conclusion
The solution applies **range reduction + mapping**:  
- Random picks are restricted to `[0, M-1]`.  
- Blacklisted numbers in that range are remapped to valid numbers beyond M.  
- Guarantees **uniform distribution** with **O(1) pick time**, even for large `n`.  


---
