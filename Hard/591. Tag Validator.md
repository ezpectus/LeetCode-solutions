# 591. Tag Validator

---

## Problem Restatement
We need to validate a code snippet string according to strict rules:
- Must be wrapped in a valid closed tag.  
- Tag names: only uppercase letters, length [1,9].  
- Content: may contain nested valid tags, CDATA, or characters.  
- CDATA: `<![CDATA[ ... ]]>` treated as plain text.  
- Tags must be properly nested and matched.  

---

## Key Idea
- Use a **stack** to track open tags.  
- Traverse the string:
  - If we encounter `<![CDATA[`, skip until `]]>`.  
  - If we encounter `<TAG>`, validate name and push onto stack.  
  - If we encounter `</TAG>`, validate name and check it matches the top of stack.  
  - Otherwise, treat as text.  
- At the end, stack must be empty and the entire code must be wrapped in a valid tag.

---

## Code (C#)
```csharp
using System;
using System.Collections.Generic;

public class Solution {
    public bool IsValid(string code) {
        Stack<string> stack = new Stack<string>();
        int i = 0;
        int n = code.Length;

        while (i < n) {
            if (i > 0 && stack.Count == 0) return false; // must be wrapped

            if (i + 9 < n && code.Substring(i, 9) == "<![CDATA[") {
                int j = code.IndexOf("]]>", i + 9);
                if (j < 0) return false;
                i = j + 3;
            } else if (i + 2 < n && code.Substring(i, 2) == "</") {
                int j = code.IndexOf('>', i + 2);
                if (j < 0) return false;
                string tagName = code.Substring(i + 2, j - (i + 2));
                if (!IsValidTagName(tagName)) return false;
                if (stack.Count == 0 || stack.Peek() != tagName) return false;
                stack.Pop();
                i = j + 1;
            } else if (code[i] == '<') {
                int j = code.IndexOf('>', i + 1);
                if (j < 0) return false;
                string tagName = code.Substring(i + 1, j - (i + 1));
                if (!IsValidTagName(tagName)) return false;
                stack.Push(tagName);
                i = j + 1;
            } else {
                i++;
            }
        }

        return stack.Count == 0;
    }

    private bool IsValidTagName(string name) {
        if (name.Length < 1 || name.Length > 9) return false;
        foreach (char c in name) {
            if (c < 'A' || c > 'Z') return false;
        }
        return true;
    }
}
```


## Time Complexity
- **Traversal:** Each character in the code string is processed exactly once.  
- **Operations:** Tag parsing, CDATA skipping, and stack push/pop are constant-time.  
- **Overall:** **O(n)**, where n = length of the code.  

---

## Space Complexity
- **Stack:** Stores open tags until they are closed.  
- **Auxiliary checks:** CDATA and tag name validation use constant space.  
- **Overall:** **O(n)**, proportional to nesting depth.  

---

## Example Walkthrough

### Example 1
**Input:** `"<DIV>This is the first line <![CDATA[<div>]]></DIV>"`  
- `<DIV>` pushed onto stack.  
- CDATA skipped as raw text.  
- `</DIV>` popped from stack.  
- Stack empty at end → ✅ Output = `true`.  

---

### Example 2
**Input:** `"<DIV>>> ![cdata[]] <![CDATA[<div>]>]]>]]>>]</DIV>"`  
- `<DIV>` pushed onto stack.  
- CDATA skipped as raw text.  
- `</DIV>` popped from stack.  
- Stack empty at end → ✅ Output = `true`.  

---

### Example 3
**Input:** `"<A> <B> </A> </B>"`  
- `<A>` pushed.  
- `<B>` pushed.  
- `</A>` mismatched (top of stack is `<B>`).  
- ❌ Output = `false`.  

---

## Why This Works
- **Stack-based validation:** Ensures tags are properly nested and matched.  
- **CDATA handling:** Skipped entirely, treated as plain text.  
- **Tag name validation:** Enforces uppercase-only names of length [1,9].  
- **Wrapping check:** Guarantees the entire code is enclosed in a valid tag.  

---

✅ **Conclusion**  
This is the **Stack-Based Tag Validation Algorithm**.  
By parsing tags, validating names, handling CDATA, and enforcing nesting rules, we achieve an efficient **O(n)** solution with **O(n)** space, ensuring correctness for all valid and invalid tag structures.


---
